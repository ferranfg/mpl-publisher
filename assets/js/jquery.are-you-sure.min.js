/*!
 * jQuery Plugin: Are-You-Sure (Dirty Form Detection)
 * https://github.com/codedance/jquery.AreYouSure/
 *
 * Copyright (c) 2012-2014, Chris Dance and PaperCut Software http://www.papercut.com/
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Author:  chris.dance@papercut.com
 * Version: 1.9.0
 * Date:    13th August 2014
 */
(function(a){a.fn.areYouSure=function(j){var d=a.extend({message:"You have unsaved changes!",dirtyClass:"dirty",change:null,silent:false,addRemoveFieldsMarksDirty:false,fieldEvents:"change keyup propertychange input",fieldSelector:":input:not(input[type=submit]):not(input[type=button])"},j);var e=function(l){if(l.hasClass("ays-ignore")||l.hasClass("aysIgnore")||l.attr("data-ays-ignore")||l.attr("name")===undefined){return null}if(l.is(":disabled")){return"ays-disabled"}var m;var k=l.attr("type");if(l.is("select")){k="select"}switch(k){case"checkbox":case"radio":m=l.is(":checked");break;case"select":m="";l.find("option").each(function(p){var n=a(this);if(n.is(":selected")){m+=n.val()}});break;default:m=l.val()}return m};var i=function(k){k.data("ays-orig",e(k))};var g=function(l){var n=function(q){var p=q.data("ays-orig");if(undefined===p){return false}return(e(q)!=p)};var m=(a(this).is("form"))?a(this):a(this).parents("form");if(n(a(l.target))){c(m,true);return}$fields=m.find(d.fieldSelector);if(d.addRemoveFieldsMarksDirty){var k=m.data("ays-orig-field-count");if(k!=$fields.length){c(m,true);return}}var o=false;$fields.each(function(){$field=a(this);if(n($field)){o=true;return false}});c(m,o)};var f=function(l){var k=l.find(d.fieldSelector);a(k).each(function(){i(a(this))});a(k).unbind(d.fieldEvents,g);a(k).bind(d.fieldEvents,g);l.data("ays-orig-field-count",a(k).length);c(l,false)};var c=function(k,l){var m=l!=k.hasClass(d.dirtyClass);k.toggleClass(d.dirtyClass,l);if(m){if(d.change){d.change.call(k,k)}if(l){k.trigger("dirty.areYouSure",[k])}if(!l){k.trigger("clean.areYouSure",[k])}k.trigger("change.areYouSure",[k])}};var b=function(){var l=a(this);var k=l.find(d.fieldSelector);a(k).each(function(){var m=a(this);if(!m.data("ays-orig")){i(m);m.bind(d.fieldEvents,g)}});l.trigger("checkform.areYouSure")};var h=function(){f(a(this))};if(!d.silent&&!window.aysUnloadSet){window.aysUnloadSet=true;a(window).bind("beforeunload",function(){$dirtyForms=a("form").filter("."+d.dirtyClass);if($dirtyForms.length==0){return}if(navigator.userAgent.toLowerCase().match(/msie|chrome/)){if(window.aysHasPrompted){return}window.aysHasPrompted=true;window.setTimeout(function(){window.aysHasPrompted=false},900)}return d.message})}return this.each(function(l){if(!a(this).is("form")){return}var k=a(this);k.submit(function(){k.removeClass(d.dirtyClass)});k.bind("reset",function(){c(k,false)});k.bind("rescan.areYouSure",b);k.bind("reinitialize.areYouSure",h);k.bind("checkform.areYouSure",g);f(k)})}})(jQuery);